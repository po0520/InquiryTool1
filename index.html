<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>科學探究學習單</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2pdf.js for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
    
    body {
      font-family: 'Noto Sans TC', sans-serif;
    }
    
    .print-only {
      display: none;
    }
    
    @media print {
      .no-print {
        display: none !important;
      }
      
      .print-only {
        display: block;
      }
      
      .print-table {
        width: 100%;
        border-collapse: collapse;
      }
      
      .print-table th,
      .print-table td {
        border: 1px solid #000;
        padding: 8px;
      }
    }
    
    .image-preview {
      max-width: 100px;
      max-height: 100px;
      object-fit: contain;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header Section -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-3xl font-bold text-indigo-700">科學探究學習單</h1>
        <div class="flex space-x-2 no-print">
          <button id="add-record" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md flex items-center transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            新增紀錄
          </button>
          <button id="export-pdf" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md flex items-center transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" />
            </svg>
            匯出 PDF
          </button>
          <button id="export-html" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            匯出 HTML
          </button>
        </div>
      </div>
      
      <!-- Student Info Section -->
      <div id="student-info" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="form-group">
          <label class="block text-gray-700 mb-1">班級</label>
          <input type="text" id="class" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div class="form-group">
          <label class="block text-gray-700 mb-1">座號</label>
          <input type="number" id="seat" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div class="form-group">
          <label class="block text-gray-700 mb-1">姓名</label>
          <input type="text" id="name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
      </div>
    </div>
    
    <!-- Records Table -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">觀察紀錄</h2>
      <div class="overflow-x-auto">
        <table id="records-table" class="w-full border-collapse">
          <thead>
            <tr class="bg-indigo-100">
              <th class="border border-gray-300 px-4 py-2 text-left">#</th>
              <th class="border border-gray-300 px-4 py-2 text-left">數量</th>
              <th class="border border-gray-300 px-4 py-2 text-left">圖片</th>
              <th class="border border-gray-300 px-4 py-2 text-left">顏色</th>
              <th class="border border-gray-300 px-4 py-2 text-left">我還觀察到…</th>
              <th class="border border-gray-300 px-4 py-2 text-center no-print">操作</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        
        <!-- Empty state message -->
        <div id="empty-state" class="text-center py-8 text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          <p>尚未有觀察紀錄，請點擊「新增紀錄」按鈕開始記錄。</p>
        </div>
      </div>
    </div>
    
    <!-- Print version (only visible when printing) -->
    <div class="print-only mt-8">
      <h2 class="text-xl font-bold mb-4">科學探究學習單 - 列印版</h2>
      <div class="mb-4">
        <p><strong>班級：</strong> <span id="print-class"></span></p>
        <p><strong>座號：</strong> <span id="print-seat"></span></p>
        <p><strong>姓名：</strong> <span id="print-name"></span></p>
      </div>
      <table class="print-table">
        <thead>
          <tr>
            <th>#</th>
            <th>數量</th>
            <th>圖片</th>
            <th>顏色</th>
            <th>我還觀察到…</th>
          </tr>
        </thead>
        <tbody id="print-records"></tbody>
      </table>
    </div>
  </div>

  <script>
    let recordCount = 0;
    
    // Check if there are records to show/hide empty state
    function updateEmptyState() {
      const tbody = document.querySelector('#records-table tbody');
      const emptyState = document.getElementById('empty-state');
      
      if (tbody.children.length === 0) {
        emptyState.classList.remove('hidden');
      } else {
        emptyState.classList.add('hidden');
      }
    }
    
    // Initialize
    updateEmptyState();
    
    // Add new record
    document.getElementById('add-record').addEventListener('click', () => {
      recordCount++;
      const tbody = document.querySelector('#records-table tbody');
      const tr = document.createElement('tr');
      tr.className = 'hover:bg-gray-50';
      
      // Index
      const tdIndex = document.createElement('td');
      tdIndex.className = 'border border-gray-300 px-4 py-2';
      tdIndex.textContent = recordCount;
      
      // Quantity input
      const tdQty = document.createElement('td');
      tdQty.className = 'border border-gray-300 px-4 py-2';
      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.min = '0';
      qtyInput.value = '0';
      qtyInput.className = 'w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500';
      tdQty.appendChild(qtyInput);
      
      // Image upload
      const tdImg = document.createElement('td');
      tdImg.className = 'border border-gray-300 px-4 py-2';
      
      const imgContainer = document.createElement('div');
      imgContainer.className = 'flex flex-col items-center';
      
      const imgPreview = document.createElement('img');
      imgPreview.className = 'image-preview mb-2 hidden';
      imgPreview.alt = '預覽圖';
      
      const imgInput = document.createElement('input');
      imgInput.type = 'file';
      imgInput.accept = 'image/*';
      imgInput.className = 'w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100';
      
      imgInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
          const reader = new FileReader();
          reader.onload = (event) => {
            imgPreview.src = event.target.result;
            imgPreview.classList.remove('hidden');
          };
          reader.readAsDataURL(e.target.files[0]);
        }
      });
      
      imgContainer.appendChild(imgPreview);
      imgContainer.appendChild(imgInput);
      tdImg.appendChild(imgContainer);
      
      // Color picker
      const tdColor = document.createElement('td');
      tdColor.className = 'border border-gray-300 px-4 py-2';
      
      const colorContainer = document.createElement('div');
      colorContainer.className = 'flex items-center';
      
      const colorInput = document.createElement('input');
      colorInput.type = 'color';
      colorInput.value = '#3B82F6'; // Default to a nice blue
      colorInput.className = 'w-10 h-10 border-0 p-0 mr-2';
      
      const colorValue = document.createElement('span');
      colorValue.textContent = colorInput.value;
      colorValue.className = 'text-sm text-gray-600';
      
      colorInput.addEventListener('input', () => {
        colorValue.textContent = colorInput.value;
      });
      
      colorContainer.appendChild(colorInput);
      colorContainer.appendChild(colorValue);
      tdColor.appendChild(colorContainer);
      
      // Observation text
      const tdText = document.createElement('td');
      tdText.className = 'border border-gray-300 px-4 py-2';
      const textInput = document.createElement('textarea');
      textInput.className = 'w-full px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500';
      textInput.placeholder = '我還觀察到…';
      textInput.rows = 2;
      tdText.appendChild(textInput);
      
      // Actions column
      const tdActions = document.createElement('td');
      tdActions.className = 'border border-gray-300 px-4 py-2 text-center no-print';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'bg-red-500 hover:bg-red-600 text-white p-1 rounded-md transition-colors';
      deleteBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
      `;
      
      deleteBtn.addEventListener('click', () => {
        tr.remove();
        updateEmptyState();
      });
      
      tdActions.appendChild(deleteBtn);
      
      tr.append(tdIndex, tdQty, tdImg, tdColor, tdText, tdActions);
      tbody.appendChild(tr);
      
      updateEmptyState();
    });
    
    // Export PDF
    document.getElementById('export-pdf').addEventListener('click', () => {
      // Update print version with current data
      document.getElementById('print-class').textContent = document.getElementById('class').value;
      document.getElementById('print-seat').textContent = document.getElementById('seat').value;
      document.getElementById('print-name').textContent = document.getElementById('name').value;
      
      const printRecords = document.getElementById('print-records');
      printRecords.innerHTML = '';
      
      const rows = document.querySelectorAll('#records-table tbody tr');
      rows.forEach(row => {
        const newRow = document.createElement('tr');
        
        // Index
        const tdIndex = document.createElement('td');
        tdIndex.textContent = row.cells[0].textContent;
        
        // Quantity
        const tdQty = document.createElement('td');
        tdQty.textContent = row.cells[1].querySelector('input').value;
        
        // Image
        const tdImg = document.createElement('td');
        const imgPreview = row.cells[2].querySelector('img');
        if (imgPreview && !imgPreview.classList.contains('hidden')) {
          const img = document.createElement('img');
          img.src = imgPreview.src;
          img.style.maxWidth = '100px';
          img.style.maxHeight = '100px';
          tdImg.appendChild(img);
        } else {
          tdImg.textContent = '無圖片';
        }
        
        // Color
        const tdColor = document.createElement('td');
        const colorValue = row.cells[3].querySelector('input').value;
        const colorSwatch = document.createElement('div');
        colorSwatch.style.backgroundColor = colorValue;
        colorSwatch.style.width = '20px';
        colorSwatch.style.height = '20px';
        colorSwatch.style.display = 'inline-block';
        colorSwatch.style.marginRight = '5px';
        colorSwatch.style.border = '1px solid #ccc';
        tdColor.appendChild(colorSwatch);
        tdColor.appendChild(document.createTextNode(colorValue));
        
        // Text
        const tdText = document.createElement('td');
        tdText.textContent = row.cells[4].querySelector('textarea').value;
        
        newRow.append(tdIndex, tdQty, tdImg, tdColor, tdText);
        printRecords.appendChild(newRow);
      });
      
      // Generate PDF
      const element = document.body;
      const opt = {
        margin: 10,
        filename: '科學探究學習單.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      
      html2pdf().set(opt).from(element).save();
    });
    
    // Export HTML
    document.getElementById('export-html').addEventListener('click', () => {
      // Create a clean version for export
      const exportDoc = document.implementation.createHTMLDocument('科學探究學習單');
      
      // Copy the current document's head
      const head = exportDoc.createElement('head');
      head.innerHTML = document.head.innerHTML;
      exportDoc.head.replaceWith(head);
      
      // Create a clean body with only the necessary elements
      const body = exportDoc.createElement('body');
      body.className = 'bg-white p-8';
      
      // Add student info
      const studentInfo = document.createElement('div');
      studentInfo.className = 'mb-6';
      studentInfo.innerHTML = `
        <h1 class="text-3xl font-bold text-center mb-6">科學探究學習單</h1>
        <div class="grid grid-cols-3 gap-4">
          <div><strong>班級：</strong> ${document.getElementById('class').value}</div>
          <div><strong>座號：</strong> ${document.getElementById('seat').value}</div>
          <div><strong>姓名：</strong> ${document.getElementById('name').value}</div>
        </div>
      `;
      
      // Add records table
      const table = document.createElement('table');
      table.className = 'w-full border-collapse mt-6';
      table.innerHTML = `
        <thead>
          <tr class="bg-gray-100">
            <th class="border border-gray-300 px-4 py-2 text-left">#</th>
            <th class="border border-gray-300 px-4 py-2 text-left">數量</th>
            <th class="border border-gray-300 px-4 py-2 text-left">圖片</th>
            <th class="border border-gray-300 px-4 py-2 text-left">顏色</th>
            <th class="border border-gray-300 px-4 py-2 text-left">我還觀察到…</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      
      // Copy records
      const rows = document.querySelectorAll('#records-table tbody tr');
      rows.forEach(row => {
        const newRow = document.createElement('tr');
        
        // Index
        const tdIndex = document.createElement('td');
        tdIndex.className = 'border border-gray-300 px-4 py-2';
        tdIndex.textContent = row.cells[0].textContent;
        
        // Quantity
        const tdQty = document.createElement('td');
        tdQty.className = 'border border-gray-300 px-4 py-2';
        tdQty.textContent = row.cells[1].querySelector('input').value;
        
        // Image
        const tdImg = document.createElement('td');
        tdImg.className = 'border border-gray-300 px-4 py-2';
        const imgPreview = row.cells[2].querySelector('img');
        if (imgPreview && !imgPreview.classList.contains('hidden')) {
          const img = document.createElement('img');
          img.src = imgPreview.src;
          img.style.maxWidth = '100px';
          img.style.maxHeight = '100px';
          tdImg.appendChild(img);
        } else {
          tdImg.textContent = '無圖片';
        }
        
        // Color
        const tdColor = document.createElement('td');
        tdColor.className = 'border border-gray-300 px-4 py-2';
        const colorValue = row.cells[3].querySelector('input').value;
        const colorSwatch = document.createElement('div');
        colorSwatch.style.backgroundColor = colorValue;
        colorSwatch.style.width = '20px';
        colorSwatch.style.height = '20px';
        colorSwatch.style.display = 'inline-block';
        colorSwatch.style.marginRight = '5px';
        colorSwatch.style.border = '1px solid #ccc';
        tdColor.appendChild(colorSwatch);
        tdColor.appendChild(document.createTextNode(colorValue));
        
        // Text
        const tdText = document.createElement('td');
        tdText.className = 'border border-gray-300 px-4 py-2';
        tdText.textContent = row.cells[4].querySelector('textarea').value;
        
        newRow.append(tdIndex, tdQty, tdImg, tdColor, tdText);
        table.querySelector('tbody').appendChild(newRow);
      });
      
      body.appendChild(studentInfo);
      body.appendChild(table);
      exportDoc.body = body;
      
      // Create and download the HTML file
      const docContent = '<!DOCTYPE html>' + exportDoc.documentElement.outerHTML;
      const blob = new Blob([docContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = '科學探究學習單.html';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9524111b2465f21c',t:'MTc1MDM0NzAxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

